# ðŸš€ å¿«é€Ÿå•Ÿå‹•æŒ‡å—

## å·²ç‚ºæ‚¨æº–å‚™å¥½æ¸¬è©¦æ•¸æ“šï¼

âœ… å·²ç”Ÿæˆ 50 ç­†æ¸¬è©¦æ•¸æ“šï¼š
- **sensor_data.csv** - CSV æ ¼å¼ï¼ˆFlask ä½¿ç”¨ï¼‰
- **sensor_data.xlsx** - Excel æ ¼å¼ï¼ˆå¯ç”¨ Excel/LibreOffice é–‹å•ŸæŸ¥çœ‹ï¼‰

## ç«‹å³å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼

### æ–¹æ³• 1ï¼šåœ¨çµ‚ç«¯æ©Ÿä¸­é‹è¡Œï¼ˆæŽ¨è–¦ï¼‰

```bashcd 

uv run python app_flask.py
```

å•Ÿå‹•å¾Œï¼Œåœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ï¼š
- **http://localhost:8080**
- **http://172.20.10.3:8080** ï¼ˆå¾žå…¶ä»–è£ç½®ï¼‰

### æ–¹æ³• 2ï¼šèƒŒæ™¯é‹è¡Œ

```bash
cd /home/pi/Documents/GitHub/2025_10_26_chihlee_pi_pico_Steve/lesson6
nohup uv run python app_flask.py > app.log 2>&1 &

å¯æŸ¥è©¢é‹è¡Œç¨‹åºï¼š ps aux | grep app_flask.py
```

æŸ¥çœ‹é‹è¡Œç‹€æ…‹ï¼š
```bash
tail -f app.log
```

åœæ­¢æ‡‰ç”¨ç¨‹å¼ï¼š
```bash
pkill -f "python app_flask.py"
```

## ðŸ“Š æ¸¬è©¦æ•¸æ“šèªªæ˜Ž

ç”Ÿæˆçš„ 50 ç­†æ¸¬è©¦æ•¸æ“šåŒ…å«ï¼š
- **æ™‚é–“ç¯„åœ**ï¼šç´„ 4 å°æ™‚çš„æ­·å²æ•¸æ“š
- **æº«åº¦ç¯„åœ**ï¼š22.5Â°C ~ 32.0Â°C
- **æ¿•åº¦ç¯„åœ**ï¼š55% ~ 70%
- **é›»ç‡ˆç‹€æ…‹**ï¼šæ¨¡æ“¬ç™½å¤©å¤šé—œã€æ™šä¸Šå¤šé–‹

## ðŸŽ¯ æ‡‰è©²çœ‹åˆ°ä»€éº¼ï¼Ÿ

å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼å¾Œï¼Œç¶²é æœƒé¡¯ç¤ºï¼š

### 1. é ‚éƒ¨ç‹€æ…‹åˆ—
- ðŸŸ¢ MQTT é€£ç·šç‹€æ…‹ï¼ˆç¶ è‰² = å·²é€£ç·šï¼‰
- â° æœ€å¾Œæ›´æ–°æ™‚é–“
- ðŸ“Š ç¸½è¨˜éŒ„æ•¸ï¼š50

### 2. ä¸‰å€‹æ•¸æ“šå¡ç‰‡
- ðŸ’¡ **é›»ç‡ˆç‹€æ…‹**ï¼šå¤§åž‹åœ“å½¢æŒ‡ç¤ºå™¨ï¼ˆé»ƒè‰²æˆ–ç°è‰²ï¼‰
- ðŸŒ¡ï¸ **å®¢å»³æº«åº¦**ï¼šé¡¯ç¤ºæœ€æ–°æº«åº¦å€¼
- ðŸ’§ **å®¢å»³æ¿•åº¦**ï¼šé¡¯ç¤ºæœ€æ–°æ¿•åº¦å€¼

### 3. æ­·å²è¶¨å‹¢åœ–è¡¨
- ðŸ“ˆ é›™ Y è»¸æŠ˜ç·šåœ–
- ç´…ç·šï¼šæº«åº¦è®ŠåŒ–
- è—ç·šï¼šæ¿•åº¦è®ŠåŒ–
- å¯çœ‹åˆ°å®Œæ•´çš„ 50 ç­†æ•¸æ“šè¶¨å‹¢

## ðŸ”„ é‡æ–°ç”Ÿæˆæ¸¬è©¦æ•¸æ“š

å¦‚æžœæƒ³è¦ä¸åŒçš„æ¸¬è©¦æ•¸æ“šï¼š

```bash
cd /home/pi/Documents/GitHub/2025_10_26_chihlee_pi_pico/lesson6
uv run python generate_test_data.py
```

ä¿®æ”¹æ•¸æ“šé‡ï¼ˆç·¨è¼¯ `generate_test_data.py`ï¼‰ï¼š
```python
# ç¬¬ 107 è¡Œé™„è¿‘
data = generate_test_data(count=100)  # æ”¹ç‚º 100 ç­†
```

## ðŸ“¡ æŽ¥æ”¶å³æ™‚ MQTT æ•¸æ“š

åœ¨**å¦ä¸€å€‹çµ‚ç«¯æ©Ÿ**ä¸­é‹è¡Œæ¸¬è©¦ç™¼å¸ƒè…³æœ¬ï¼š

```bash
cd /home/pi/Documents/GitHub/2025_10_26_chihlee_pi_pico_Steve/lesson6
uv run python test_mqtt_publish.py
```

é€™æœƒï¼š
1. ç™¼é€ 10 ç­†æ–°çš„æ¸¬è©¦æ•¸æ“šåˆ° MQTT
2. Flask æ‡‰ç”¨ç¨‹å¼æœƒå³æ™‚æŽ¥æ”¶ä¸¦é¡¯ç¤º
3. ç¶²é æœƒè‡ªå‹•æ›´æ–°ï¼ˆç„¡éœ€åˆ·æ–°ï¼‰
4. æ–°æ•¸æ“šæœƒè‡ªå‹•è¿½åŠ åˆ° CSV æª”æ¡ˆ

## ðŸ“ æª”æ¡ˆåˆ—è¡¨

| æª”æ¡ˆ | èªªæ˜Ž | ç”¨é€” |
|------|------|------|
| `app_flask.py` | Flask æ‡‰ç”¨ç¨‹å¼ | **ä¸»ç¨‹å¼**ï¼ˆåŸ·è¡Œæ­¤æª”æ¡ˆï¼‰ |
| `sensor_data.csv` | CSV æ•¸æ“šæª”æ¡ˆ | æ¸¬è©¦æ•¸æ“šï¼ˆå·²ç”Ÿæˆï¼‰ |
| `sensor_data.xlsx` | Excel æ•¸æ“šæª”æ¡ˆ | æ¸¬è©¦æ•¸æ“šï¼ˆå¯æŸ¥çœ‹ï¼‰ |
| `generate_test_data.py` | æ•¸æ“šç”Ÿæˆå·¥å…· | ç”Ÿæˆæ¸¬è©¦æ•¸æ“š |
| `test_mqtt_publish.py` | MQTT æ¸¬è©¦å·¥å…· | ç™¼é€ MQTT è¨Šæ¯ |
| `templates/index.html` | ç¶²é æ¨¡æ¿ | å‰ç«¯ä»‹é¢ |

## â“ å¸¸è¦‹å•é¡Œ

### Q1: ç•«é¢æ²’æœ‰é¡¯ç¤ºæ•¸æ“šï¼Ÿ
**A**: ç¢ºèªçµ‚ç«¯æ©Ÿæœ‰é¡¯ç¤ºã€Œâœ… å·²è¼‰å…¥ 50 ç­†æ­·å²æ•¸æ“šã€

### Q2: MQTT ç‹€æ…‹é¡¯ç¤ºæœªé€£ç·šï¼Ÿ
**A**: é€™æ˜¯æ­£å¸¸çš„ï¼Œå› ç‚ºï¼š
- æ¸¬è©¦æ•¸æ“šä¾†è‡ª CSV æª”æ¡ˆï¼Œä¸éœ€è¦ MQTT
- å¦‚éœ€ MQTT åŠŸèƒ½ï¼Œç¢ºèª mosquitto æ­£åœ¨é‹è¡Œï¼š
  ```bash
  sudo systemctl status mosquitto
  ```

### Q3: æƒ³æŸ¥çœ‹ Excel æª”æ¡ˆå…§å®¹ï¼Ÿ
**A**: ä½¿ç”¨ LibreOffice é–‹å•Ÿï¼š
```bash
libreoffice sensor_data.xlsx
```

## ðŸŽ‰ å®Œæˆï¼

ç¾åœ¨æ‚¨æœ‰ä¸€å€‹å®Œæ•´çš„ MQTT ç›£æŽ§å„€è¡¨æ¿ï¼ŒåŒ…å«ï¼š
- âœ… 50 ç­†æ¸¬è©¦æ­·å²æ•¸æ“š
- âœ… ç¾Žè§€çš„ç¶²é ä»‹é¢
- âœ… å³æ™‚ MQTT æŽ¥æ”¶åŠŸèƒ½
- âœ… è‡ªå‹•æ•¸æ“šå„²å­˜

äº«å—ä½¿ç”¨å§ï¼ðŸš€

å¼·æ‡¶äººä¸€éµéƒ¨ç½²å°±æ˜¯ä¸‹é¢é€™æ®µã€Œç›´æŽ¥è¤‡è£½è²¼ä¸Šã€åˆ°ä½ çš„æ¨¹èŽ“æ´¾çµ‚ç«¯æ©Ÿè£¡ï¼ŒæŒ‰ Enter å°±å…¨éƒ¨è‡ªå‹•æžå®šï¼ˆåŒ…å«å»ºç«‹ serviceã€å•Ÿå‹•ã€é–‹æ©Ÿè‡ªå‹•åŸ·è¡Œï¼‰ï¼š
Bashsudo bash -c 'cat > /etc/systemd/system/flask-app.service << "EOF"
[Unit]
Description=Chihlee Pi Pico Flask App
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/Documents/GitHub/2025_10_26_chihlee_pi_pico_Steve/lesson6
ExecStart=/usr/bin/uv run python app_flask.py
Environment=PATH=/home/pi/.local/bin:/usr/local/bin:/usr/bin:/bin
StandardOutput=append:/home/pi/Documents/GitHub/2025_10_26_chihlee_pi_pico_Steve/lesson6/app.log
StandardError=append:/home/pi/Documents/GitHub/2025_10_26_chihlee_pi_pico_Steve/lesson6/app.log
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable --now flask-app.service
echo "æ­å–œï¼ä¸€éµéƒ¨ç½²å®Œæˆï¼"
echo "ç¾åœ¨é–‹å§‹å¯ä»¥ç”¨ä¸‹é¢é€™äº›æŒ‡ä»¤ç®¡ç†ï¼š"
echo "  sudo systemctl status flask-app.service    æŸ¥çœ‹ç‹€æ…‹"
echo "  sudo systemctl stop flask-app.service      åœæ­¢"
echo "  sudo systemctl start flask-app.service     å•Ÿå‹•"
echo "  sudo systemctl restart flask-app.service   é‡å•Ÿ"
echo "  journalctl -u flask-app.service -f         å³æ™‚çœ‹ log"
'
æ“ä½œæ­¥é©Ÿï¼ˆè¶…ç°¡å–®ï¼Œåªæœ‰ä¸‰æ­¥ï¼‰

ç”¨ SSH æˆ–ç›´æŽ¥åœ¨æ¨¹èŽ“æ´¾çµ‚ç«¯æ©Ÿç™»å…¥ pi ä½¿ç”¨è€…
æŠŠä¸Šé¢æ•´æ®µç¨‹å¼ç¢¼ã€Œå…¨éƒ¨è¤‡è£½ã€
åœ¨çµ‚ç«¯æ©Ÿå³éµé»žä¸€ä¸‹ â†’ è²¼ä¸Š â†’ æŒ‰ Enter éµåŸ·è¡Œï¼ˆæœƒå•ä½ ä¸€æ¬¡ sudo å¯†ç¢¼ï¼‰

å¤§æ¦‚ 3~5 ç§’å°±æœƒé¡¯ç¤ºã€Œæ­å–œï¼ä¸€éµéƒ¨ç½²å®Œæˆï¼ã€
æ­¤æ™‚ä½ çš„ Flask å·²ç¶“ç«‹åˆ»é–‹å§‹è·‘äº†ï¼Œè€Œä¸”ä»¥å¾Œæ¨¹èŽ“æ´¾æ¯ä¸€æ¬¡é–‹æ©Ÿéƒ½æœƒè‡ªå‹•åŸ·è¡Œï¼Œç¨‹å¼å°±ç®— crash ä¹Ÿæœƒ 3 ç§’å¾Œè‡ªå‹•é‡å•Ÿã€‚
é©—è­‰æ˜¯å¦çœŸçš„æˆåŠŸï¼ˆå¯é¸ï¼‰
Bash# çœ‹ç‹€æ…‹ï¼ˆçœ‹åˆ° Active: active (running) å°±ä»£è¡¨æˆåŠŸï¼‰
sudo systemctl status flask-app.service

# å³æ™‚çœ‹ log
journalctl -u flask-app.service -f
é€™æ¨£å°±çœŸçš„ 100% æžå®šï¼Œä»¥å¾Œå†ä¹Ÿä¸ç”¨æ‰‹å‹•æ•² nohup äº†ï¼
æƒ³è¦åœæŽ‰æˆ–é‡é–‹çš„æ™‚å€™å°±ç›´æŽ¥æ‰“ï¼š
Bashsudo systemctl restart flask-app.service   # æœ€å¸¸ç”¨